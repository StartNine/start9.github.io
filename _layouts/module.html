---
layout: empty
type: one-box fade-in post module-page
title: Module
---
{% for module in site.data.modules %}
	{% if module.id == page.id %}
		{% assign item = module %}
	{% endif %}
{% endfor %}

<header class="header">
	{% include header.html %}
</header>
	
{% if item.preview %}
<img class="marketplace-coverimage" src="{{ site.url }}/assets/img/previews/{{ item.preview }}" alt="Cover image, featuring {{ item.title }}"/>
{% else %}
<img class="marketplace-coverimage" src="{{ site.url }}/assets/img/previews/{{ item.image }}" alt="Cover image, featuring {{ item.title }}"/>
{% endif %}

<main class="{{ page.type }} {{ layout.type }}" data-order="{{ page.order }}">
		<span class="invisible"><br></span>
		<div class="skip-target" id="maincontent"></div>

		<div class="cover">
			<div class="card" style="background: linear-gradient(rgba(var(--card-1), .8), rgba(var(--card-2), .9));">
				<span class="info">
					<h1 style="margin: 0;">{{ item.title }}</h1>
					by <strong>{{ item.authorname }}</strong>
				</span>
		
				<span class="install">
					<a class="button" href="start9://view-plugin/{{ item.id}}">
						{% include icon.html icon="icon-logo" width="1em" height="1em" %}
						 View in Start9
					</a>
				</span>
			</div><br>
		</div>
		
		<article class="js-self-link">
			<!-- View source & View author link -->
			{% if item.source %}
			<a class="button" href="{{ item.source }}">
				{% include icon.html icon="icon-embed2" width="1em" height="1em" %}
				 View code
			</a>
			{% endif %}

			{% if item.authorlink %}
			<a class="button" href="{{ item.authorlink }}">
				{% include icon.html icon="icon-link" width="1em" height="1em" %}
				 View author&rsquo;s website
			</a>
			{% endif %}

			<!-- Tagline -->
			{% if item.tagline %}
			<br><br><i>
				{{ item.tagline }}
			</i>
			{% endif %}

			<!-- Tags -->
			{% if item.tags %}
			<br><i>
				tags: 
				{{ item.tags }}
			</i>
			{% endif %}
			
			<br>

			<!-- Markdown content -->
			{{ content }}
			<div id="rendered-md"></div>
		</article>

</main>

{% include photoswipe.html %}

{% if page.readme %}
	<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.10/purify.min.js" integrity="sha256-sUyI169bxYQrBE0eTLEZND8u458gdCMPCYHyFvRCBWU=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.6.2/marked.min.js" integrity="sha256-2yeMGat6dji573K4Wk2L4Z/nI540v5nowfSZjPg3ROI=" crossorigin="anonymous"></script>

	<script>
		/*
		** Fetch, santiize, and render markdown
		** TODO: bit slow, needs optimize
		** ! Needs to be checked for XSS and other
		*/
		marked.setOptions({
			smartypants: true
		});

		var httpRequest = new XMLHttpRequest();

		httpRequest.onreadystatechange = function(data) {
			const config = {
				ALLOW_DATA_ATTR: false,
				FORBID_ATTR: ["style"],
				FORBID_TAGS: ["style", "body", "img", "iframe", "html", "audio", "video", "canvas"]
			};

			const soap = DOMPurify.sanitize( data.currentTarget.response, config ) + "";

			document.getElementById("rendered-md").innerHTML =
				DOMPurify.sanitize( marked(soap) );

			/* deletes the first h1 */
			if (document.querySelector("#rendered-md h1") != null ) {
				document.querySelector("#rendered-md h1").remove();
			};

			/* 
			** Assumes that by the time the md doc has been fetched and santized, 
			** main.js will be loaded and ready to call addSelfLink
			*/
			if (document.querySelector("#rendered-md .self-link") != null) {
				$(".js-self-link #rendered-md h2, .js-self-link #rendered-md h3").addSelfLink();
			};

		};

		/* Just in case, make sure DOMPurify is working before HTTP request is made */
		if (DOMPurify) {
			/* Trust nobody but Microsoft (R) */
			if ( "{{ page.readme }}".startsWith("https://raw.githubusercontent.com/") ) {
				httpRequest.open("GET", "{{ page.readme }}");
				httpRequest.send();
			} else { throw "error: external readme not from GitHub!" }
		} else { document.getElementById("rendered-md").innerHTML = "Error! Please reload the page." }

	</script>
{% endif %}
